(()=>{function y(a){let r=a.trim().split(`
`).map(n=>n.trim());if(r.length<2)return[];let e=r[0].replace(/^\||\|$/g,"").split("|").map(n=>n.trim()),o=r.slice(2).map(n=>{let t=n.replace(/^\||\|$/g,"").split("|").map(c=>c.trim()),i={};return e.forEach((c,l)=>{i[c]=t[l]||""}),i});return o.forEach(n=>{(n.term?.trim()||"").startsWith("?")&&(n._ignore=!0)}),o}function x(a){let r={},e=/(?:"([^"]+)"|'([^']+)'|([\w-]+))\^("([^"]+)"|'([^']+)'|([\w-]+))/gi;for(let s of a)for(let o of["term","sub-term","notes"]){let n=s[o]||"",t;for(;(t=e.exec(n))!==null;){let i=(t[1]||t[2]||t[3]||"").toLowerCase().trim(),c="";t[5]?c=t[5].trim():t[6]?c=t[6].trim():t[7]&&(c=t[7].trim()),i&&c&&(r[i]=c)}}return r}function E(a){let r=/(?:"([^"]+)"|'([^']+)'|([\w-]+))\^("([^"]+)"|'([^']+)'|([\w-]+))/gi;for(let e of a)for(let s of["term","sub-term","notes"])e[s]&&(e[s]=e[s].replace(r,(o,n,t,i)=>n||t||i||""))}function k(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $(a,r){for(let e of a)["term","sub-term","notes"].forEach(s=>{let o=e[s]||"",n={};for(let t of Object.keys(r)){let i=new RegExp(`\\!\\b${k(t)}\\b`,"gi");o=o.replace(i,c=>{let l=`temp_placeholder_${t.toUpperCase()}`;return n[l]=c.slice(1),l})}for(let[t,i]of Object.entries(r)){let c=new RegExp(`\\b${k(t)}\\b`,"gi");o=o.replace(c,i)}for(let[t,i]of Object.entries(n)){let c=new RegExp(k(t),"g");o=o.replace(c,i)}e[s]=o})}function v(a){let r=[],e={term:"",subTerm:"",notes:"",book:0,page:0};for(let s of a){if(s._ignore)continue;let o=(s.term||"").trim(),n=(s["sub-term"]||"").trim(),t=(s.notes||"").trim(),i=(s.book||"").trim(),c=(s.page||"").trim(),l=o!=="",h=n!=="",T=t!=="",p=i!=="",m=c!=="",u=o,d=n,f=t,b=p?parseInt(i):0,g=m?parseInt(c):0;l&&!h&&!T&&!p&&!m&&!o.endsWith("*")?(u=o,d="",f="",b=e.book,g=e.page):l&&!h&&!T&&!p&&!m&&o.endsWith("*")?(u=o.replace(/\*$/,""),d=e.subTerm,f=e.notes,b=e.book,g=e.page):!l&&h&&!T&&!p&&!m?(u=e.term,d=n,f="",b=e.book,g=e.page):(u=o||e.term,d=n,f=t,b=p?parseInt(i):e.book,g=m?parseInt(c):e.page);let w={term:u,subTerm:d,notes:f,book:b,page:g};r.push(w),e=w}return r.sort((s,o)=>{let n=s.term.localeCompare(o.term);if(n!==0)return n;let t=s.subTerm.localeCompare(o.subTerm);return t!==0?t:s.book-o.book}),r}function _(a){let r=document.createElement("table");r.innerHTML=`
    <thead>
      <tr><th>Term</th><th>Sub-term</th><th>Notes</th><th>Book</th><th>Page</th></tr>
    </thead>
    <tbody>
      ${a.map(e=>`
        <tr>
          <td>${e.term}</td>
          <td>${e.subTerm}</td>
          <td>${e.notes}</td>
          <td>${e.book}</td>
          <td>${e.page}</td>
        </tr>
      `).join("")}
    </tbody>
  `,document.getElementById("output").innerHTML="",document.getElementById("output").appendChild(r)}function I(){document.getElementById("create_index_button").addEventListener("click",()=>{let a=document.getElementById("index_input").value,r=y(a),e=x(r);E(r),$(r,e);let s=v(r);_(s)})}typeof document<"u"&&I();})();
